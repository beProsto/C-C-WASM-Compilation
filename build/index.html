<meta charset="utf-8">
<style>
	* {
		background-color: rgb(75, 75, 75);
		color: rgb(220, 220, 220);
	}
</style>


<!-- this is just because I don't expect everyone to want to open up the console -->
<script>
	console.log = (str) => {
		document.body.innerHTML += "<h1>" + str + "</h1>";
	};
</script>

<!-- emscripten is very easy to use - not that easy to install however -->
<script src="emscripten/main.js"></script>

<script>
	let frameId;
	window.onkeydown = (e) => {
		window.cancelAnimationFrame(frameId);
		console.log("Stopped!");
	};
</script>


<!-- simpler things done with wasm are easy to use -->
<script type="module">
	(async () => {
		const { instance } = await WebAssembly.instantiateStreaming(
			fetch("./llvm/func.wasm")
		);
		console.log("func's result: " + instance.exports.function_name(3, 2));
	})();
</script>

<!-- Here we have a function that returns the address to the start of a static string 
	We read it from the start to finish (when byte hidden under the pointer is NULL) 
	And print the result out on the screen :D -->
<script type="module">
	async function init() {
		const { instance } = await WebAssembly.instantiateStreaming(
			fetch("./llvm/main.wasm"),
			{
				env: {
					// functions to import to our wasm code
					__wasm_import_console_log_str: (_ptr) => {
						const memory_buffer = new Uint8Array(instance.exports.memory.buffer);
						let text_buffer = "";
						
						for(; memory_buffer[_ptr] != 0; _ptr++) {
							text_buffer += String.fromCharCode(memory_buffer[_ptr]);
						}

						console.log(text_buffer);
					},
					__wasm_import_console_log_num: (_num) => {
						console.log(_num);
					},
					__wasm_import_winreqanim_call: () => {
						frameId = window.requestAnimationFrame(instance.exports.__wasm_export_winreqanim_callback_execute);
					}
				}
			}
		);
		instance.exports.hello();
	}
	
	async function init2() {
		const { instance } = await WebAssembly.instantiateStreaming(
			fetch("./wat/testin_it.wasm"),
			{
				env: {
					console_log_number: (_num) => {console.log("This log has been imported into the wasm module: " + _num)},
					console_log_string: (_ptr) => {
						const memory_buffer = new Uint8Array(instance.exports.memory.buffer);
						let text_buffer = "";
						
						for(; memory_buffer[_ptr] != 0; _ptr++) {
							text_buffer += String.fromCharCode(memory_buffer[_ptr]);
						}

						console.log(text_buffer);
					}
				}
			}
		);
		
		console.log("Testing the wat to wasm compilation: " + instance.exports.testing_attention_please(2, 3));
	}

	init();
	init2();
</script>

